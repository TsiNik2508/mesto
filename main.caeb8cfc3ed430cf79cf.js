(()=>{"use strict";const e=class{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._submitButton=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=e.nextElementSibling;s.textContent=t,s.classList.add(this._config.errorClass),e.classList.add(this._config.inputErrorClass)}_hideInputError(e){const t=e.nextElementSibling;t.textContent="",t.classList.remove(this._config.errorClass),e.classList.remove(this._config.inputErrorClass)}_checkInputValidity(e){if(e.validity.valid)this._hideInputError(e);else{const t=e.validationMessage;this._showInputError(e,t)}}toggleButtonState(){this._hasInvalidInput()?(this._submitButton.disabled=!0,this._submitButton.classList.add(this._config.inactiveButtonClass)):(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._config.inactiveButtonClass))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._setEventListeners(),this.toggleButtonState()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this.toggleButtonState()}};const t=class{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}))}};const s=class extends t{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__img"),this._popupCaption=this._popup.querySelector(".popup__card-name")}open(e){this._popupImage.src=e.link,this._popupImage.alt=e.name,this._popupCaption.textContent=e.name,super.open()}};class n extends t{constructor(e,t){super(e),this._handlerFormSubmit=t,this._inputList=Array.from(this._popup.querySelectorAll(".popup__input")),this._form=this._popup.querySelector(".popup__form"),this._button=this._popup.querySelector(".popup__button"),this._buttonText=this._button.textContent}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранение...";this._button.textContent=e?t:this._buttonText}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handlerFormSubmit(this._getInputValues())}))}}const i=class{constructor(e){this._userName=e.name,this._userAbout=e.about,this._userAvatar=e.avatar,this._userId=e._id}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent,avatar:this._userAvatar.src}}setUserInfo(e){let{name:t,about:s}=e;t&&(this._userName.textContent=t),s&&(this._userAbout.textContent=s)}setUserAvatar(e){this._userAvatar.src=e.avatar}};const o=class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t),this._items=[]}renderItems(e){e.reverse().forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}removeItem(e){const t=this._container.querySelector('[data-card-id="'.concat(e,'"]'));t&&t.remove()}setItems(e){this._items=e}};class r{constructor(e,t,s,n,i,o){this._name=e.name,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._cardId=e._id,this._template=document.querySelector(t),this._handleCardClick=s,this._handleCardDelete=n,this._handleLike=i,this._userId=o,this.isLike=!1}_getTemplate(){return this._template.content.querySelector(".element").cloneNode(!0)}createCardElement(){return this._newCard=this._getTemplate(),this._imageElement=this._newCard.querySelector(".element__img"),this._imageElement.src=this._link,this._imageElement.alt=this._name,this._buttonLike=this._newCard.querySelector(".element__button"),this._buttonDelete=this._newCard.querySelector(".element__thrash-button"),this._likeCounter=this._newCard.querySelector(".element__like-count"),this._setData(),this._setEventListeners(),this._likeCounter.textContent=this._likes.length,this.toggleVisibleLikeCounter(),this._likes.some((e=>e._id===this._userId))&&(this.isLike=!0,this._buttonLike.classList.add("element__button_active")),this._userId!==this._ownerId&&this._buttonDelete.remove(),this._newCard}_setData(){this._newCard.querySelector(".element__title").textContent=this._name,this._imageElement.src=this._link,this._imageElement.alt=this._name}deleteCard(){this._newCard.remove(),this._newCard=null,this._imageElement=null,this._buttonLike=null}_likeCard(){this._buttonLike.classList.toggle("element__button_active")}_setEventListeners(){this._buttonDelete.addEventListener("click",(()=>{this._handleCardDelete(this,this._cardId)})),this._buttonLike.addEventListener("click",(()=>{this._handleLike(this,this._cardId)})),this._imageElement.addEventListener("click",(()=>{this._handleCardClick(this._getCardInfo())}))}_getCardInfo(){return{name:this._name,link:this._link}}getLikes(e){this._likes=e,this._likeCounter.textContent=this._likes.length}updateLikes(e){this.getLikes(e),this.toggleButtonLike(),this.toggleValueLike(),this.toggleVisibleLikeCounter()}toggleButtonLike(){this._buttonLike.classList.toggle("element__button_active")}toggleValueLike(){this.isLike=!this.isLike}toggleVisibleLikeCounter(){0!==this._likes.length?this._likeCounter.classList.add("element__like-count_active"):this._likeCounter.classList.remove("element__like-count_active")}}const a=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),u=document.querySelector(".popup__form_edit"),_=document.querySelector(".popup_type-add"),c=(document.querySelector(".elements"),document.querySelectorAll(".popup__close"),document.querySelector(".profile__title")),h=document.querySelector(".profile__bio"),d=document.querySelector(".profile__avatar"),p=_.querySelector(".popup__form"),m=(p.querySelector(".popup__input_type_name"),p.querySelector(".popup__input_type_link"),document.querySelector(".popup__input_type_name"),document.querySelector(".popup__input_type_bio"),u.querySelector(".popup__button"),document.querySelector(".profile__avatar-edit-button")),g=(document.querySelectorAll(".popup"),document.querySelector(".popup_type-edit"),document.querySelector(".popup_type-edit .popup__form")),L=document.querySelector(".popup__form_add"),b=document.querySelector(".popup__form_type-avatar"),v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"};let k;const y=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}_request(e,t){return fetch(e,t).then(this._checkResponse)}getUserInfo(){return this._request("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:this._headers})}getInitialCards(){return this._request("".concat(this._baseUrl,"/cards"),{method:"GET",headers:this._headers})}editUserInfo(e){return this._request("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})})}addCard(e){return this._request("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})})}deleteCard(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers})}updateAvatar(e){return this._request("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})})}putLike(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers})}deleteLike(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers})}}({baseUrl:"https://nomoreparties.co/v1/cohort-75",headers:{authorization:"15456b01-b272-4795-9fed-b0870e9982e9","Content-Type":"application/json"}});Promise.all([y.getUserInfo(),y.getInitialCards()]).then((e=>{let[t,s]=e;const n=t,i=s;k=n._id,w.setUserInfo(n),w.setUserAvatar(n),q.renderItems(i)})).catch((e=>console.log(e)));const C=new s(".popup_type-card");function E(e){return new r(e,"#card-template",f,S,I,k).createCardElement()}function f(e,t){C.open(e,t)}function S(e,t){B.open(e,t)}function I(e){e.isLike?y.deleteLike(e._cardId).then((t=>{e.updateLikes(t.likes)})).catch((e=>{console.log(e)})):y.putLike(e._cardId).then((t=>{e.updateLikes(t.likes)})).catch((e=>{console.log(e)}))}C.setEventListeners();const q=new o({items:[],renderer:e=>q.addItem(E(e))},".elements"),w=new i({name:c,about:h,avatar:d}),U=new n(".popup_type-add",(function(e,t){U.renderLoading(!0),y.addCard(e,t).then((e=>{const t=E(e);q.addItem(t),U.close()})).catch((e=>console.log(e))).finally((()=>{U.renderLoading(!1)}))}));U.setEventListeners();const x=new e(v,g),V=new e(v,L),A=new e(v,b);x.enableValidation(),V.enableValidation(),A.enableValidation(),l.addEventListener("click",(()=>{U.open(),V.resetValidation()}));const B=new class extends t{constructor(e,t){super(e),this._handlerDeleteSubmit=t,this._button=this._popup.querySelector(".popup__button"),this._buttonText=this._button.textContent}open(e,t){super.open(),this._card=e,this._cardId=t}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранение...";this._button.textContent=e?t:this._buttonText}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handlerDeleteSubmit(this._card)}))}}(".popup_type-delete",(function(e){B.renderLoading(!0,"Удаление..."),y.deleteCard(e._cardId).then((()=>{e.deleteCard(),B.close()})).catch((e=>console.log(e))).finally((()=>{B.renderLoading(!1)}))}));B.setEventListeners();const T=new n(".popup_type-edit",(function(e){T.renderLoading(!0),y.editUserInfo(e).then((()=>{w.setUserInfo(e),T.close()})).catch((e=>{console.log(e)})).finally((()=>{T.renderLoading(!1)}))}));T.setEventListeners(),a.addEventListener("click",(()=>{T.setInputValues(w.getUserInfo()),T.open(),x.resetValidation()})),m.addEventListener("click",(()=>{D.open(),A.resetValidation()}));const D=new n(".popup_type-avatar",(function(e){D.renderLoading(!0),y.updateAvatar(e).then((()=>{w.setUserAvatar(e),D.close()})).catch((e=>{console.log(e)})).finally((()=>{D.renderLoading(!1)}))}));D.setEventListeners(),d.addEventListener("click",(()=>{D.open(),A.resetValidation()}))})();