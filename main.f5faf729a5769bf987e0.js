(()=>{"use strict";function e(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const t=class{constructor(t,s,n,i,o,r,a){e(this,"_handleLikeButtonClick",(()=>{this._handleLikeClick(this._data)})),e(this,"_handleDeleteButtonClick",(()=>{this._handleDeleteClick(this._data)})),e(this,"_handleImageClick",(()=>{this._handleCardClick(this._data)})),this._data=t,this._templateSelector=s,this._handleCardClick=n,this._handleLikeClick=i,this._handleDeleteClick=o,this._UserId=a,this._isOwner=r,this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".element__button"),this._deleteButton=this._element.querySelector(".element__thrash-button"),this._cardImage=this._element.querySelector(".element__img"),this._likeCount=this._element.querySelector(".element__like-count"),this._setEventListeners()}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._likeButton.addEventListener("click",this._handleLikeButtonClick),this._deleteButton.addEventListener("click",this._handleDeleteButtonClick),this._cardImage.addEventListener("click",this._handleImageClick)}generateCard(){if(!this._data)return console.error("Ошибка: отсутствуют данные карточки."),null;const{name:e,link:t}=this._data;return this._cardImage.src=t,this._cardImage.alt=e,this._element.querySelector(".element__title").textContent=e,this._isOwner?this._element.querySelector(".element__thrash-button").classList.add("visible"):this._element.querySelector(".element__thrash-button").classList.remove("visible"),this._element}setLikes(e){this._likes=e,this._likeCount.textContent=e.length}updateLikes(e){this._likeCount.textContent=e.length,this._likeButton.classList.toggle("element__button_active",e.some((e=>e._id===UserId)))}removeCard(){this._element.remove()}};const s=class{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._submitButton=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=e.nextElementSibling;s.textContent=t,s.classList.add(this._config.errorClass),e.classList.add(this._config.inputErrorClass)}_hideInputError(e){const t=e.nextElementSibling;t.textContent="",t.classList.remove(this._config.errorClass),e.classList.remove(this._config.inputErrorClass)}_checkInputValidity(e){if(e.validity.valid)this._hideInputError(e);else{const t=e.validationMessage;this._showInputError(e,t)}}toggleButtonState(){this._hasInvalidInput()?(this._submitButton.disabled=!0,this._submitButton.classList.add(this._config.inactiveButtonClass)):(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._config.inactiveButtonClass))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._setEventListeners(),this.toggleButtonState()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this.toggleButtonState()}};const n=class{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}setCardId(e){this._cardId=e}_handleEscClose(e){"Escape"===e.key&&this.close()}open(e){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose),this.setCardId(e)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}))}};const i=class extends n{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__img"),this._popupCaption=this._popup.querySelector(".popup__card-name"),this._cardId=null}setCardId(e){this._cardId=e}open(e){this._popupImage.src=e.link,this._popupImage.alt=e.name,this._popupCaption.textContent=e.name,super.open()}};const o=class extends n{constructor(e,t){super(e),this._submitHandler=t,this._form=this._popup.querySelector(".popup__form"),this._inputs=Array.from(this._form.querySelectorAll(".popup__input")),this._submitButton=this._form.querySelector(".popup__button")}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(this._getInputValues())}))}open(){super.open(),this._submitButton.textContent="Сохранение..."}setSubmitButtonCaption(e){this._submitButton.textContent=e}close(){super.close(),this._form.reset()}};const r=class{constructor(e){let{nameSelector:t,bioSelector:s}=e;this._nameElement=document.querySelector(t),this._bioElement=document.querySelector(s),this._id=null}getUserInfo(){return{name:this._nameElement.textContent,bio:this._bioElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._bioElement.textContent=e.about,this._id=e._id}getUserId(){return this._id}};const a=class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getUserInfo(){return fetch("".concat(this.baseUrl,"/users/me"),{headers:{authorization:this.headers.authorization,"Content-Type":this.headers["Content-Type"],cohort:"cohort-75"}}).then(this._checkResponse)}getInitialCards(){return fetch("".concat(this.baseUrl,"/cards"),{headers:this.headers}).then(this._checkResponse)}editUserInfo(e){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then(this._checkResponse)}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:s})}).then(this._checkResponse)}deleteCard(e){return console.log("Deleting card with ID:",e),fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}likeCard(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then(this._checkResponse)}unlikeCard(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}updateAvatar(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this.headers.authorization,"Content-Type":this.headers["Content-Type"]},body:JSON.stringify({avatar:e})}).then(this._checkResponse).catch((e=>{console.error("Ошибка при обновлении аватара: ".concat(e))}))}};const c=class extends n{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._form.querySelector(".popup__button"),this._cardId=null}setCardId(e){this._cardId=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}setEventListeners(){super.setEventListeners(),this._popup.querySelector(".popup__close").addEventListener("click",(()=>{this.close()}))}open(e){this.setCardId(e),super.open()}};const l=class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}removeItem(e){const t=this._container.querySelector('[data-card-id="'.concat(e,'"]'));t&&t.remove()}};let h;const u=new a({baseUrl:"https://nomoreparties.co/v1/cohort-75",headers:{authorization:"15456b01-b272-4795-9fed-b0870e9982e9","Content-Type":"application/json"}}),d=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),p=document.querySelector(".popup__form_edit"),m=document.querySelector(".popup__form_add"),f=(document.querySelector(".elements"),new i(".popup_type-card"));f.setEventListeners();new s({inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},m).enableValidation();const b=new o(".popup_type-add",(e=>{u.addCard(e).then((e=>{addCardToPage(e),b.close()})).catch((e=>{console.error("Ошибка при добавлении карточки: ".concat(e))}))}));b.setEventListeners();const C=new r({nameSelector:".profile__title",bioSelector:".profile__bio"});function v(e){if(!e)return void console.error("Неверный cardId");const t=new c(".popup_type-delete",(()=>{u.deleteCard(e).then((()=>{y.removeItem(e),t.close()})).catch((e=>{console.error("Ошибка при удалении карточки: ".concat(e))}))}));t.setEventListeners(),t.open()}const y=new l({items:[],renderer:e=>{const s=function(e){const s=e.owner&&e.owner._id===h,n=new t(e,"#card-template",(()=>function(e){f.open(e)}(e)),(()=>function(e,t,s){const n=e.likes.some((e=>e._id===s)),i=e._id;n?u.unlikeCard(i).then((e=>{t.updateLikes(e.likes)})).catch((e=>{console.error("Ошибка при удалении лайка: ".concat(e))})):u.likeCard(i).then((e=>{t.updateLikes(e.likes)})).catch((e=>{console.error("Ошибка при добавлении лайка: ".concat(e))}))}(e,n,h)),v,s);return n.generateCard()}(e);y.addItem(s)}},".elements");Promise.all([u.getUserInfo(),u.getInitialCards()]).then((e=>{let[t,s]=e;C.setUserInfo(t),h=t._id,y.renderItems(s)})).catch((e=>{console.error("Ошибка при загрузке данных с сервера: ".concat(e))}));const k=p.querySelector(".popup__input_type_name"),E=p.querySelector(".popup__input_type_bio"),g=new o(".popup_type-edit",(e=>{!function(e){u.editUserInfo(e).then((e=>{C.setUserInfo(e),g.close()})).catch((e=>{console.error("Ошибка при редактировании профиля: ".concat(e))}))}(e),g.close()}));g.setEventListeners(),d.addEventListener("click",(()=>function(){const e=C.getUserInfo();k.value=e.name,E.value=e.bio,g.open()}())),_.addEventListener("click",(()=>b.open()))})();